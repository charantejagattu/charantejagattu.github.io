(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[636],{588:(e,s,n)=>{Promise.resolve().then(n.bind(n,3126))},3126:(e,s,n)=>{"use strict";n.r(s),n.d(s,{default:()=>i});var a=n(6001),t=n(9973),l=n(8794);function i(){var e,s,n,i,r,o,c,d,u,m,h,p,f,v,j,x,g,N,b,_,y,k,C,S,A,w,O;let[P,E]=(0,t.useState)(null),[F,T]=(0,t.useState)(""),[D,Y]=(0,t.useState)(!1),[L,B]=(0,t.useState)({}),[V,z]=(0,t.useState)(!1),[I,W]=(0,t.useState)({line1:"",line2:"",city:"",state:"",pincode:"",address_type:"home"}),[q,R]=(0,t.useState)(""),[J,U]=(0,t.useState)(!1),[G,H]=(0,t.useState)(null),[K,M]=(0,t.useState)(!1),[Q,X]=(0,t.useState)(""),[Z,$]=(0,t.useState)("");(0,t.useEffect)(()=>{!async function(){try{var e,s,n;let a=localStorage.getItem("accessToken");if(!a)return void T("Not authenticated");let t=await fetch("".concat("https://travis-2d4m.onrender.com/api/v1","/users/profile"),{method:"GET",headers:{Authorization:"Bearer ".concat(a)}});if(!t.ok){let e=await t.json();T(e.message||"Failed to fetch profile");return}let l=await t.json();E(l),B({full_name:l.full_name,phone:l.phone,occupation:l.occupation,income_range:l.income_range,pan_number:l.pan_number,preferences:{theme:(null==(e=l.preferences)?void 0:e.theme)||"",notification_push:null!=(n=null==(s=l.preferences)?void 0:s.notification_push)&&n}})}catch(e){T("Failed to connect to the server")}}()},[]);let ee=e=>{let{name:s,value:n,type:a}=e.target,t="checkbox"===a,l=t&&"checked"in e.target?e.target.checked:void 0;if(s.startsWith("preferences.")){let e=s.split(".")[1];B(s=>({...s,preferences:{...s.preferences,[e]:t?l:n}}))}else B(e=>({...e,[s]:n}))},es=async e=>{e.preventDefault(),T("");try{var s,n;let e=localStorage.getItem("accessToken");if(!e)return void T("Not authenticated");let a={full_name:L.full_name,phone:L.phone,occupation:L.occupation,income_range:L.income_range,pan_number:L.pan_number,preferences:{theme:null==(s=L.preferences)?void 0:s.theme,notification_push:!!(null==(n=L.preferences)?void 0:n.notification_push)}},t=await fetch("".concat("https://travis-2d4m.onrender.com/api/v1","/users/profile"),{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:JSON.stringify(a)}),l=await t.json();if(!t.ok)return void T(l.detail?Array.isArray(l.detail)?l.detail.map(e=>e.msg||JSON.stringify(e)).join(", "):l.detail:l.message||"Failed to update profile");E(l),Y(!1)}catch(e){T("Failed to connect to the server")}},en=e=>{let{name:s,value:n}=e.target;W(e=>({...e,[s]:n}))},ea=async e=>{e.preventDefault(),R(""),U(!0);try{let e=localStorage.getItem("accessToken");if(!e){R("Not authenticated"),U(!1);return}let s=await fetch("".concat("https://travis-2d4m.onrender.com/api/v1","/users/addresses"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:JSON.stringify(I)}),n=await s.json();if(!s.ok){R(n.message||"Failed to add address"),U(!1);return}E(e=>({...e,addresses:[...e.addresses||[],n]})),z(!1),W({line1:"",line2:"",city:"",state:"",pincode:"",address_type:"home"})}catch(e){R("Failed to connect to the server")}U(!1)},et=async e=>{H(e),R("");try{let s=localStorage.getItem("accessToken");if(!s){R("Not authenticated"),H(null);return}let n=await fetch("".concat("https://travis-2d4m.onrender.com/api/v1","/users/addresses/").concat(e),{method:"DELETE",headers:{Authorization:"Bearer ".concat(s)}}),a=await n.json();if(!n.ok){R(a.message||"Failed to delete address"),H(null);return}E(s=>({...s,addresses:(s.addresses||[]).filter(s=>s.id!==e)}))}catch(e){R("Failed to connect to the server")}H(null)},el=async e=>{if(X(""),$(""),!e.target.files||0===e.target.files.length)return;let s=e.target.files[0],n=new FormData;n.append("file",s),M(!0);try{let e=localStorage.getItem("accessToken");if(!e){X("Not authenticated"),M(!1);return}let s=await fetch("".concat("https://travis-2d4m.onrender.com/api/v1","/users/upload-avatar"),{method:"POST",headers:{Authorization:"Bearer ".concat(e)},body:n}),a=await s.json();if(!s.ok){X(a.message||"Failed to upload avatar"),M(!1);return}$("Avatar uploaded successfully"),E(e=>({...e,profile_picture_url:a.profile_picture_url||e.profile_picture_url}))}catch(e){X("Failed to connect to the server")}M(!1)};return F?(0,a.jsx)("div",{className:"alert alert-danger",children:F}):P?(0,a.jsxs)("div",{children:[(0,a.jsxs)("form",{className:"card p-4",onSubmit:D?es:void 0,children:[(0,a.jsxs)("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[(0,a.jsx)("h2",{className:"mb-0",children:"Profile"}),(0,a.jsx)("button",{type:"button",className:"btn btn-link",title:"Edit Profile",onClick:()=>Y(!0),disabled:D,children:"Edit"})]}),(0,a.jsxs)("div",{className:"mb-3 text-center",children:[P.profile_picture_url?(0,a.jsx)(l.default,{src:(null==(e=P.profile_picture_url)?void 0:e.startsWith("http"))?P.profile_picture_url:"".concat("https://travis-2d4m.onrender.com/api/v1","/uploads/avatars/").concat(P.profile_picture_url),alt:"Avatar",width:96,height:96,style:{borderRadius:"50%",objectFit:"cover",marginBottom:8},unoptimized:null==(s=P.profile_picture_url)?void 0:s.startsWith("http")}):(0,a.jsx)("div",{style:{width:96,height:96,borderRadius:"50%",background:"#eee",display:"inline-block",marginBottom:8}}),(0,a.jsx)("div",{children:(0,a.jsxs)("label",{className:"btn btn-outline-secondary btn-sm mt-2",children:[K?"Uploading...":"Upload Avatar",(0,a.jsx)("input",{type:"file",accept:"image/*",style:{display:"none"},onChange:el,disabled:K})]})}),Q&&(0,a.jsx)("div",{className:"alert alert-danger mt-2",children:Q}),Z&&(0,a.jsx)("div",{className:"alert alert-success mt-2",children:Z})]}),(0,a.jsxs)("div",{className:"mb-2",children:[(0,a.jsx)("strong",{children:"Email:"})," ",(0,a.jsx)("input",{className:"form-control",value:P.email||"",readOnly:!0})]}),(0,a.jsxs)("div",{className:"mb-2",children:[(0,a.jsx)("strong",{children:"Phone:"})," ",D?(0,a.jsx)("input",{className:"form-control",name:"phone",value:L.phone||"",onChange:ee}):(0,a.jsx)("input",{className:"form-control",value:P.phone||"",readOnly:!0})]}),(0,a.jsxs)("div",{className:"mb-2",children:[(0,a.jsx)("strong",{children:"Full Name:"})," ",D?(0,a.jsx)("input",{className:"form-control",name:"full_name",value:L.full_name||"",onChange:ee}):(0,a.jsx)("input",{className:"form-control",value:P.full_name||"",readOnly:!0})]}),(0,a.jsxs)("div",{className:"mb-2",children:[(0,a.jsx)("strong",{children:"Date of Birth:"})," ",(0,a.jsx)("input",{className:"form-control",value:P.date_of_birth||"",readOnly:!0})]}),(0,a.jsxs)("div",{className:"mb-2",children:[(0,a.jsx)("strong",{children:"Occupation:"})," ",D?(0,a.jsx)("input",{className:"form-control",name:"occupation",value:L.occupation||"",onChange:ee}):(0,a.jsx)("input",{className:"form-control",value:P.occupation||"",readOnly:!0})]}),(0,a.jsxs)("div",{className:"mb-2",children:[(0,a.jsx)("strong",{children:"Income Range:"})," ",D?(0,a.jsx)("input",{className:"form-control",name:"income_range",value:L.income_range||"",onChange:ee}):(0,a.jsx)("input",{className:"form-control",value:P.income_range||"",readOnly:!0})]}),(0,a.jsxs)("div",{className:"mb-2",children:[(0,a.jsx)("strong",{children:"PAN Number:"})," ",D?(0,a.jsx)("input",{className:"form-control",name:"pan_number",value:L.pan_number||"",onChange:ee}):(0,a.jsx)("input",{className:"form-control",value:P.pan_number||"",readOnly:!0})]}),(0,a.jsxs)("div",{className:"mb-2",children:[(0,a.jsx)("strong",{children:"Roles:"})," ",(0,a.jsx)("input",{className:"form-control",value:(null==(n=P.roles)?void 0:n.join(", "))||"",readOnly:!0})]}),(0,a.jsxs)("div",{className:"mb-2",children:[(0,a.jsx)("strong",{children:"Created At:"})," ",(0,a.jsx)("input",{className:"form-control",value:P.created_at||"",readOnly:!0})]}),(0,a.jsxs)("div",{className:"mb-2",children:[(0,a.jsx)("strong",{children:"Last Login:"})," ",(0,a.jsx)("input",{className:"form-control",value:P.last_login||"",readOnly:!0})]}),(0,a.jsxs)("div",{className:"mb-2",children:[(0,a.jsx)("strong",{children:"Account Count:"})," ",(0,a.jsx)("input",{className:"form-control",value:null!=(C=P.account_count)?C:"",readOnly:!0})]}),(0,a.jsxs)("div",{className:"mb-2",children:[(0,a.jsx)("strong",{children:"Goal Count:"})," ",(0,a.jsx)("input",{className:"form-control",value:null!=(S=P.goal_count)?S:"",readOnly:!0})]}),(0,a.jsxs)("div",{className:"mb-2",children:[(0,a.jsx)("strong",{children:"Portfolio Count:"})," ",(0,a.jsx)("input",{className:"form-control",value:null!=(A=P.portfolio_count)?A:"",readOnly:!0})]}),(0,a.jsxs)("div",{className:"mb-2",children:[(0,a.jsx)("strong",{children:"Addresses:"}),(0,a.jsx)("ul",{children:null==(i=P.addresses)?void 0:i.map((e,s)=>(0,a.jsxs)("li",{children:[e.line1,", ",e.line2,", ",e.city,", ",e.state,","," ",e.country,", ",e.pincode," (",e.address_type,")",e.id&&(0,a.jsx)("button",{type:"button",className:"btn btn-danger btn-sm ms-2",style:{verticalAlign:"baseline"},onClick:()=>et(e.id),disabled:G===e.id,children:G===e.id?"Deleting...":"Delete"})]},e.id||s))}),(0,a.jsx)("button",{type:"button",className:"btn btn-sm btn-outline-primary mt-2",onClick:()=>z(e=>!e),children:V?"Cancel":"Add Address"}),q&&(0,a.jsx)("div",{className:"alert alert-danger mt-2",children:q})]}),(0,a.jsxs)("div",{className:"mb-2",children:[(0,a.jsx)("strong",{children:"Preferences:"}),(0,a.jsxs)("ul",{children:[(0,a.jsxs)("li",{children:["Theme:"," ",D?(0,a.jsxs)("select",{className:"form-control d-inline w-auto",name:"preferences.theme",value:(null==(r=L.preferences)?void 0:r.theme)||"",onChange:ee,children:[(0,a.jsx)("option",{value:"light",children:"Light"}),(0,a.jsx)("option",{value:"dark",children:"Dark"})]}):null==(o=P.preferences)?void 0:o.theme]}),(0,a.jsxs)("li",{children:["Push Notifications:"," ",D?(0,a.jsx)("input",{type:"checkbox",name:"preferences.notification_push",checked:!!(null==(c=L.preferences)?void 0:c.notification_push),onChange:ee}):(null==(d=P.preferences)?void 0:d.notification_push)?"Yes":"No"]}),(0,a.jsxs)("li",{children:["Language: ",null==(u=P.preferences)?void 0:u.language]}),(0,a.jsxs)("li",{children:["Currency Display: ",null==(m=P.preferences)?void 0:m.currency_display]}),(0,a.jsxs)("li",{children:["Email Notifications:"," ",(null==(h=P.preferences)?void 0:h.notification_email)?"Yes":"No"]}),(0,a.jsxs)("li",{children:["SMS Notifications:"," ",(null==(p=P.preferences)?void 0:p.notification_sms)?"Yes":"No"]}),(0,a.jsxs)("li",{children:["Dashboard Widgets:"," ",null==(v=P.preferences)||null==(f=v.dashboard_widgets)?void 0:f.join(", ")]})]})]}),(0,a.jsxs)("div",{className:"mb-2",children:[(0,a.jsx)("strong",{children:"KYC Status:"}),(0,a.jsxs)("ul",{children:[(0,a.jsxs)("li",{children:["PAN Verified: ",(null==(j=P.kyc_status)?void 0:j.pan_verified)?"Yes":"No"]}),(0,a.jsxs)("li",{children:["Aadhaar Verified:"," ",(null==(x=P.kyc_status)?void 0:x.aadhaar_verified)?"Yes":"No"]}),(0,a.jsxs)("li",{children:["Email Verified:"," ",(null==(g=P.kyc_status)?void 0:g.email_verified)?"Yes":"No"]}),(0,a.jsxs)("li",{children:["Phone Verified:"," ",(null==(N=P.kyc_status)?void 0:N.phone_verified)?"Yes":"No"]}),(0,a.jsxs)("li",{children:["Address Verified:"," ",(null==(b=P.kyc_status)?void 0:b.address_verified)?"Yes":"No"]}),(0,a.jsxs)("li",{children:["Document Verified:"," ",(null==(_=P.kyc_status)?void 0:_.document_verified)?"Yes":"No"]}),(0,a.jsxs)("li",{children:["Last Verified: ",null!=(w=null==(y=P.kyc_status)?void 0:y.last_verified)?w:"N/A"]}),(0,a.jsxs)("li",{children:["Notes: ",null!=(O=null==(k=P.kyc_status)?void 0:k.verification_notes)?O:"N/A"]})]})]}),D&&(0,a.jsxs)("div",{className:"d-flex gap-2 mt-3",children:[(0,a.jsx)("button",{type:"submit",className:"btn btn-success",children:"Save"}),(0,a.jsx)("button",{type:"button",className:"btn btn-secondary",onClick:()=>{var e,s,n;Y(!1),T(""),B({full_name:P.full_name,phone:P.phone,occupation:P.occupation,income_range:P.income_range,pan_number:P.pan_number,preferences:{theme:(null==(e=P.preferences)?void 0:e.theme)||"",notification_push:null!=(n=null==(s=P.preferences)?void 0:s.notification_push)&&n}})},children:"Cancel"})]})]}),V&&(0,a.jsxs)("div",{className:"card mt-3 p-3",children:[(0,a.jsx)("h5",{children:"Add Address"}),(0,a.jsxs)("form",{onSubmit:ea,children:[(0,a.jsxs)("div",{className:"row",children:[(0,a.jsx)("div",{className:"col-md-6 mb-2",children:(0,a.jsx)("input",{className:"form-control",name:"line1",placeholder:"Line 1",value:I.line1,onChange:en,required:!0})}),(0,a.jsx)("div",{className:"col-md-6 mb-2",children:(0,a.jsx)("input",{className:"form-control",name:"line2",placeholder:"Line 2",value:I.line2,onChange:en})}),(0,a.jsx)("div",{className:"col-md-4 mb-2",children:(0,a.jsx)("input",{className:"form-control",name:"city",placeholder:"City",value:I.city,onChange:en,required:!0})}),(0,a.jsx)("div",{className:"col-md-4 mb-2",children:(0,a.jsx)("input",{className:"form-control",name:"state",placeholder:"State",value:I.state,onChange:en,required:!0})}),(0,a.jsx)("div",{className:"col-md-4 mb-2",children:(0,a.jsx)("input",{className:"form-control",name:"pincode",placeholder:"Pincode",value:I.pincode,onChange:en,required:!0})}),(0,a.jsx)("div",{className:"col-md-6 mb-2",children:(0,a.jsxs)("select",{className:"form-control",name:"address_type",value:I.address_type,onChange:en,children:[(0,a.jsx)("option",{value:"home",children:"Home"}),(0,a.jsx)("option",{value:"work",children:"Work"})]})})]}),q&&(0,a.jsx)("div",{className:"alert alert-danger mt-2",children:q}),(0,a.jsx)("button",{type:"submit",className:"btn btn-success btn-sm mt-2",disabled:J,children:J?"Adding...":"Add Address"})]})]})]}):(0,a.jsx)("div",{children:"Loading..."})}}},e=>{var s=s=>e(e.s=s);e.O(0,[794,192,674,358],()=>s(588)),_N_E=e.O()}]);