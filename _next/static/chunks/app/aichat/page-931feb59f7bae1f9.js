(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[735],{3621:(e,t,a)=>{Promise.resolve().then(a.bind(a,9365))},7523:(e,t,a)=>{"use strict";a.d(t,{J1:()=>r,h_:()=>s,iD:()=>l,zu:()=>i});let s=(e,t,a,s)=>{if(localStorage.setItem("accessToken",e),localStorage.setItem("refreshToken",t),localStorage.setItem("userId",a),s)s.email&&localStorage.setItem("userEmail",s.email),s.full_name&&localStorage.setItem("userFullName",s.full_name),s.expires_in&&localStorage.setItem("expiresIn",s.expires_in.toString()),s.token_type&&localStorage.setItem("tokenType",s.token_type);else{let t=function(e){try{return JSON.parse(atob(e.split(".")[1]))}catch(e){return null}}(e);t&&t.sub&&localStorage.setItem("userId",t.sub)}},l=()=>localStorage.getItem("accessToken"),n=()=>localStorage.getItem("refreshToken"),i=()=>{localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken")},r=async()=>{let e=n();if(!e)return null;try{let t=await fetch("".concat("https://travis-2d4m.onrender.com/api/v1","/api/v1/auth/refresh"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refresh_token:e})});if(!t.ok)return i(),null;{let a=await t.json();return s(a.access_token,a.refresh_token||e,JSON.stringify({user_id:a.user_id,email:a.email,full_name:a.full_name,expires_in:a.expires_in,token_type:a.token_type})),a.access_token}}catch(e){return console.error("Error refreshing token:",e),i(),null}}},9365:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>o});var s=a(6001),l=a(9973),n=a(7523),i=a(2052),r=a(4972);function o(){var e,t,a;let[r,o]=(0,l.useState)([]),[d,c]=(0,l.useState)(""),[h,m]=(0,l.useState)(null),[u,p]=(0,l.useState)(!1),[g,x]=(0,l.useState)(""),b=(0,l.useRef)(null),[j,v]=(0,l.useState)(!1),[y,f]=(0,l.useState)([]),[_,N]=(0,l.useState)(null),[S,k]=(0,l.useState)(!1),[w,I]=(0,l.useState)(""),[C,A]=(0,l.useState)(!1),[T,F]=(0,l.useState)(!1),[E,O]=(0,l.useState)(""),[D,P]=(0,l.useState)(null),[z,B]=(0,l.useState)({start_date:"",end_date:"",category:""});l.useEffect(()=>{var e;null==(e=b.current)||e.scrollIntoView({behavior:"smooth"})},[r]),l.useEffect(()=>{(0,n.iD)()||(window.location.href="/login")},[]);let L=async e=>{e&&e.preventDefault(),x("");let t=localStorage.getItem("userId"),a=(0,n.iD)();if(!t||!a)return void x("User not authenticated");if(!d.trim())return;let s={sender:"user",text:d};o(e=>[...e,s]),p(!0);try{let e=await fetch("".concat("https://travis-2d4m.onrender.com/api/v1","/ai-coach/chat"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(a)},body:JSON.stringify({user_id:t,question:d,session_id:h})}),s=await e.json();if(!e.ok){x(s.message||"Failed to get response"),p(!1);return}m(s.session_id),o(e=>[...e,{sender:"ai",text:s.ai_response,created_at:s.created_at}]),c("")}catch(e){x("Failed to connect to the server")}p(!1)},q=async()=>{v(!0),f([]),N(null),I(""),k(!0);let e=(0,n.iD)();try{let t=await fetch("".concat("https://travis-2d4m.onrender.com/api/v1","/ai-coach/insights?timeframe=week"),{headers:{Authorization:"Bearer ".concat(e)}}),a=await t.json();if(!t.ok){I(a.message||"Failed to fetch insights"),k(!1);return}f(a.insights||[]),N(a.summary||null)}catch(e){I("Failed to connect to the server")}k(!1)},R=async e=>{e.preventDefault(),F(!0),O(""),P(null);let t=(0,n.iD)();try{let e=new URLSearchParams({start_date:z.start_date,end_date:z.end_date,category:z.category}).toString(),a=await fetch("".concat("https://travis-2d4m.onrender.com/api/v1","/ai-coach/analyze-spending?").concat(e),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)}}),s=await a.json();if(!a.ok){O(s.message||"Failed to analyze spending"),F(!1);return}P(s)}catch(e){O("Failed to connect to the server")}F(!1)};return(0,s.jsxs)("div",{className:"container py-4",style:{maxWidth:600},children:[(0,s.jsxs)("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("button",{className:"btn btn-info me-2",onClick:q,children:"Show Weekly Insights"}),(0,s.jsx)("button",{className:"btn btn-secondary",onClick:()=>{A(!0),P(null),O(""),B({start_date:"",end_date:"",category:""})},children:"Analyze Spending"})]}),(0,s.jsx)("h2",{className:"mb-0",children:"AI Coach Chat"})]}),(0,s.jsxs)("div",{style:{border:"1px solid #ddd",borderRadius:8,padding:16,minHeight:400,background:"#fafbfc",overflowY:"auto",marginBottom:16,maxHeight:500},children:[0===r.length&&(0,s.jsx)("div",{className:"text-muted text-center",children:"Ask your financial questions to the AI coach!"}),r.map((e,t)=>(0,s.jsx)("div",{className:"mb-3 d-flex ".concat("user"===e.sender?"justify-content-end":"justify-content-start"),children:(0,s.jsxs)("div",{style:{background:"user"===e.sender?"#e6f7ff":"#f5f5f5",borderRadius:12,padding:"10px 16px",maxWidth:"80%",whiteSpace:"pre-wrap",boxShadow:"0 1px 2px rgba(0,0,0,0.03)"},children:[(0,s.jsxs)("strong",{children:["user"===e.sender?"You":"AI",":"]}),(0,s.jsx)("div",{children:e.text}),e.created_at&&(0,s.jsx)("div",{className:"text-muted small mt-1",children:new Date(e.created_at).toLocaleString()})]})},t)),(0,s.jsx)("div",{ref:b})]}),g&&(0,s.jsx)("div",{className:"alert alert-danger",children:g}),(0,s.jsxs)("form",{className:"d-flex gap-2",onSubmit:L,children:[(0,s.jsx)("input",{className:"form-control",type:"text",placeholder:"Type your question...",value:d,onChange:e=>c(e.target.value),disabled:u,required:!0}),(0,s.jsx)("button",{className:"btn btn-primary",type:"submit",disabled:u||!d.trim(),children:u?"Sending...":"Send"})]}),j&&(0,s.jsx)("div",{className:"modal fade show",style:{display:"block",background:"rgba(0,0,0,0.5)"},tabIndex:-1,role:"dialog",children:(0,s.jsx)("div",{className:"modal-dialog modal-lg",role:"document",children:(0,s.jsxs)("div",{className:"modal-content",children:[(0,s.jsxs)("div",{className:"modal-header",children:[(0,s.jsx)("h5",{className:"modal-title",children:"Weekly Insights"}),(0,s.jsx)("button",{type:"button",className:"btn-close","aria-label":"Close",onClick:()=>v(!1),disabled:S})]}),(0,s.jsxs)("div",{className:"modal-body",children:[S&&(0,s.jsx)("div",{children:"Loading..."}),w&&(0,s.jsx)("div",{className:"alert alert-danger",children:w}),_&&(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("h6",{children:"Income vs Expenses"}),(0,s.jsx)(i.yP,{data:{labels:["Income","Expenses","Savings Rate %"],datasets:[{label:"Amount (₹)",data:[_.income,_.expenses,_.savings_rate],backgroundColor:["#36A2EB","#FF6384","#4BC0C0"]}]},options:{responsive:!0,plugins:{legend:{display:!1},tooltip:{enabled:!0}},scales:{y:{beginAtZero:!0}}},height:120}),(0,s.jsx)("h6",{className:"mt-4",children:"Top Expense Categories"}),(0,s.jsx)(i.yP,{data:{labels:Object.keys(_.top_expense_categories),datasets:[{label:"Amount (₹)",data:Object.values(_.top_expense_categories),backgroundColor:"#FFCE56"}]},options:{responsive:!0,plugins:{legend:{display:!1},tooltip:{enabled:!0}},scales:{y:{beginAtZero:!0}}},height:120}),(0,s.jsx)("h6",{className:"mt-4",children:"Recurring Expenses"}),(0,s.jsx)(i.yP,{data:{labels:_.recurring_expenses.items.map(e=>e.merchant),datasets:[{label:"Amount (₹)",data:_.recurring_expenses.items.map(e=>e.amount),backgroundColor:"#FF6384"}]},options:{responsive:!0,plugins:{legend:{display:!1},tooltip:{enabled:!0}},scales:{y:{beginAtZero:!0}}},height:120})]}),y.length>0&&(0,s.jsxs)("div",{children:[(0,s.jsx)("h6",{children:"Insights"}),(0,s.jsx)("ul",{children:y.map((e,t)=>(0,s.jsxs)("li",{style:{marginBottom:8},children:[(0,s.jsx)("div",{dangerouslySetInnerHTML:{__html:e.title}}),(0,s.jsx)("div",{dangerouslySetInnerHTML:{__html:e.description}})]},t))})]})]})]})})}),j&&(0,s.jsx)("div",{className:"modal-backdrop fade show",style:{display:"block"}}),C&&(0,s.jsx)("div",{className:"modal fade show",style:{display:"block",background:"rgba(0,0,0,0.5)"},tabIndex:-1,role:"dialog",children:(0,s.jsx)("div",{className:"modal-dialog modal-lg",role:"document",children:(0,s.jsxs)("form",{className:"modal-content",onSubmit:R,children:[(0,s.jsxs)("div",{className:"modal-header",children:[(0,s.jsx)("h5",{className:"modal-title",children:"Analyze Spending"}),(0,s.jsx)("button",{type:"button",className:"btn-close","aria-label":"Close",onClick:()=>A(!1),disabled:T})]}),(0,s.jsxs)("div",{className:"modal-body",children:[E&&(0,s.jsx)("div",{className:"alert alert-danger",children:E}),(0,s.jsxs)("div",{className:"row mb-3",children:[(0,s.jsxs)("div",{className:"col",children:[(0,s.jsx)("label",{className:"form-label",children:"Start Date"}),(0,s.jsx)("input",{type:"date",className:"form-control",value:z.start_date,onChange:e=>B({...z,start_date:e.target.value}),required:!0})]}),(0,s.jsxs)("div",{className:"col",children:[(0,s.jsx)("label",{className:"form-label",children:"End Date"}),(0,s.jsx)("input",{type:"date",className:"form-control",value:z.end_date,onChange:e=>B({...z,end_date:e.target.value}),required:!0})]}),(0,s.jsxs)("div",{className:"col",children:[(0,s.jsx)("label",{className:"form-label",children:"Category"}),(0,s.jsxs)("select",{className:"form-select",value:z.category,onChange:e=>B({...z,category:e.target.value}),required:!0,children:[(0,s.jsx)("option",{value:"",children:"Select"}),(0,s.jsx)("option",{value:"shopping",children:"Shopping"}),(0,s.jsx)("option",{value:"groceries",children:"Groceries"}),(0,s.jsx)("option",{value:"food_dining",children:"Food & Dining"}),(0,s.jsx)("option",{value:"travel",children:"Travel"}),(0,s.jsx)("option",{value:"bills_utilities",children:"Bills & Utilities"}),(0,s.jsx)("option",{value:"investments",children:"Investments"}),(0,s.jsx)("option",{value:"transportation",children:"Transportation"}),(0,s.jsx)("option",{value:"insurance",children:"Insurance"}),(0,s.jsx)("option",{value:"entertainment",children:"Entertainment"}),(0,s.jsx)("option",{value:"loan",children:"Loan"}),(0,s.jsx)("option",{value:"healthcare",children:"Healthcare"}),(0,s.jsx)("option",{value:"other",children:"Other"})]})]})]}),(0,s.jsx)("div",{className:"mb-3",children:(0,s.jsx)("button",{className:"btn btn-primary",type:"submit",disabled:T,children:T?"Analyzing...":"Analyze"})}),D&&(0,s.jsxs)("div",{children:[(0,s.jsx)("h6",{children:"Spending Analysis"}),(0,s.jsxs)("div",{className:"mb-3",children:[(0,s.jsx)("strong",{children:"Period:"})," ",(null==(e=D.period)?void 0:e.start_date)&&new Date(D.period.start_date).toLocaleDateString()," ","-"," ",(null==(t=D.period)?void 0:t.end_date)&&new Date(D.period.end_date).toLocaleDateString()]}),(0,s.jsxs)("div",{className:"mb-3",children:[(0,s.jsx)("strong",{children:"Total Spending:"})," ₹",null==(a=D.total_spending)?void 0:a.toLocaleString()]}),(0,s.jsx)("div",{className:"mb-3",children:(0,s.jsx)(i.yP,{data:{labels:Object.keys(D.categories||{}),datasets:[{label:"Amount (₹)",data:Object.keys(D.categories||{}).map(e=>{var t,a;return null!=(a=null==(t=D.categories[e])?void 0:t.total)?a:0}),backgroundColor:"#36A2EB"}]},options:{responsive:!0,plugins:{legend:{display:!1},tooltip:{enabled:!0}},scales:{y:{beginAtZero:!0}}},height:120})}),(0,s.jsxs)("div",{className:"mb-3",children:[(0,s.jsx)("h6",{children:"Weekly Trend"}),(0,s.jsx)(i.N1,{data:{labels:Object.keys(D.weekly_trend||{}),datasets:[{label:"Weekly Spending (₹)",data:Object.values(D.weekly_trend||{}),borderColor:"#FF6384",backgroundColor:"rgba(255,99,132,0.1)",tension:.3}]},options:{responsive:!0,plugins:{legend:{display:!0},tooltip:{enabled:!0}},scales:{y:{beginAtZero:!0}}},height:120})]}),(0,s.jsxs)("div",{className:"mb-3",children:[(0,s.jsx)("h6",{children:"Top Merchants"}),(0,s.jsx)(i.yP,{data:{labels:Object.keys(D.top_merchants||{}),datasets:[{label:"Amount (₹)",data:Object.values(D.top_merchants||{}),backgroundColor:"#FFCE56"}]},options:{responsive:!0,plugins:{legend:{display:!1},tooltip:{enabled:!0}},scales:{y:{beginAtZero:!0}}},height:120})]}),(0,s.jsxs)("div",{className:"mb-3",children:[(0,s.jsx)("h6",{children:"Analysis"}),(0,s.jsx)("div",{style:{whiteSpace:"pre-line"},children:D.analysis})]}),(0,s.jsxs)("div",{className:"mb-3",children:[(0,s.jsx)("h6",{children:"Recommendations"}),(0,s.jsx)("ul",{children:(D.recommendations||[]).map((e,t)=>(0,s.jsx)("li",{children:e},t))})]})]})]})]})})}),C&&(0,s.jsx)("div",{className:"modal-backdrop fade show",style:{display:"block"}})]})}r.t1.register(r.E8,r.PP,r.kc,r.m_,r.s$,r.No,r.FN,r.UA)}},e=>{var t=t=>e(e.s=t);e.O(0,[598,602,192,674,358],()=>t(3621)),_N_E=e.O()}]);