(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[691],{1429:(e,s,t)=>{Promise.resolve().then(t.bind(t,6761))},6761:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>i});var a=t(6001),l=t(9973),n=t(7523),r=t(2052),o=t(4972);function i(){var e,s,t,o,i,c,d,m,u,h,x,v,j,p,b;let[f,_]=(0,l.useState)(!0),[g,N]=(0,l.useState)(null),[y,k]=(0,l.useState)(""),[S,C]=(0,l.useState)(!1),[w,I]=(0,l.useState)([]),[A,F]=(0,l.useState)([]),[T,E]=(0,l.useState)(!1),[P,L]=(0,l.useState)(""),[O,D]=(0,l.useState)(""),[B,R]=(0,l.useState)({portfolio_id:"",portfolio_name:"",description:"",portfolio_type:"custom",risk_profile:"growth",instruments:[{instrument_id:"",instrument_name:"",asset_class:"",amount:0}],total_amount:0,source_account_id:""}),[q,z]=(0,l.useState)(!1),[G,J]=(0,l.useState)(!1),[U,V]=(0,l.useState)(""),[W,M]=(0,l.useState)(null),[H,Z]=(0,l.useState)(!1),[$,K]=(0,l.useState)(!1),[Q,X]=(0,l.useState)(""),[Y,ee]=(0,l.useState)(null);(0,l.useEffect)(()=>{(async()=>{_(!0),k("");try{let e=(0,n.iD)();if(!e){k("Not authenticated"),_(!1);return}let s=await fetch("".concat("https://travis-2d4m.onrender.com/api/v1","/investments/recommendations"),{method:"GET",headers:{Authorization:"Bearer ".concat(e)}}),t=await s.json();if(!s.ok){k(t.message||"Failed to get recommendations"),_(!1);return}N(t)}catch(e){k("Failed to connect to the server")}_(!1)})()},[]);let es=async()=>{C(!0),L(""),D(""),E(!1),R({portfolio_id:"",portfolio_name:"",description:"",portfolio_type:"custom",risk_profile:"growth",instruments:[{instrument_id:"",instrument_name:"",asset_class:"",amount:0}],total_amount:0,source_account_id:""});let e=(0,n.iD)();try{let s=await fetch("".concat("https://travis-2d4m.onrender.com/api/v1","/portfolios"),{headers:{Authorization:"Bearer ".concat(e)}}),t=await s.json();I(Array.isArray(t)?t:[]);let a=await fetch("".concat("https://travis-2d4m.onrender.com/api/v1","/accounts"),{headers:{Authorization:"Bearer ".concat(e)}}),l=await a.json();F(Array.isArray(l)?l:[])}catch(e){}},et=e=>{let{name:s,value:t}=e.target;R(e=>({...e,[s]:t}))},ea=(e,s,t)=>{R(a=>{let l=[...a.instruments];return l[e]={...l[e],[s]:t},{...a,instruments:l}})},el=e=>{R(s=>({...s,instruments:s.instruments.filter((s,t)=>t!==e)}))};(0,l.useEffect)(()=>{R(e=>({...e,total_amount:e.instruments.reduce((e,s)=>e+Number(s.amount||0),0)}))},[B.instruments]);let en=async e=>{e.preventDefault(),E(!0),L(""),D("");let s=(0,n.iD)();try{let e={...B,instruments:B.instruments.map(e=>({instrument_id:e.instrument_id,instrument_name:e.instrument_name,asset_class:e.asset_class,amount:Number(e.amount)})),total_amount:B.total_amount},t=await fetch("".concat("https://travis-2d4m.onrender.com/api/v1","/investments/execute"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(s)},body:JSON.stringify(e)}),a=await t.json();if(console.log("Execute response:",a),!t.ok){L(a.message||"Failed to execute investment"),E(!1);return}D("Investment executed successfully!"),C(!1)}catch(e){L("Failed to connect to the server")}E(!1)},er=async()=>{z(!0),J(!0),V(""),M(null);let e=(0,n.iD)();try{let s=await fetch("".concat("https://travis-2d4m.onrender.com/api/v1","/investments/performance"),{headers:{Authorization:"Bearer ".concat(e)}}),t=await s.json();if(!s.ok){V(t.message||"Failed to fetch performance"),J(!1);return}M(t)}catch(e){V("Failed to connect to the server")}J(!1)},eo=async()=>{K(!0),X(""),Z(!0);try{let e=(0,n.iD)(),s=await fetch("".concat("https://travis-2d4m.onrender.com/api/v1","/investments/recommendations"),{headers:{Authorization:"Bearer ".concat(e)}}),t=await s.json();if(!s.ok){X(t.message||"Failed to fetch recommendation"),K(!1);return}ee(t)}catch(e){X("Failed to connect to the server")}K(!1)},ei=()=>{Z(!1),ee(null),X("")},ec=e=>{let{name:s,value:t}=e.target;if(s.startsWith("asset_allocation.")){let e=s.split(".")[1];ee(s=>({...s,asset_allocation:{...s.asset_allocation,[e]:Number(t)}}))}else ee(e=>({...e,[s]:t}))};return(0,a.jsxs)("div",{className:"container mt-4",children:[(0,a.jsxs)("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("button",{className:"btn btn-success me-2",onClick:es,children:"Execute Investment"}),(0,a.jsx)("button",{className:"btn btn-info me-2",onClick:er,children:"Show Performance"}),(0,a.jsx)("button",{className:"btn btn-warning",onClick:eo,children:"Show Recommendation Form"})]}),(0,a.jsx)("h2",{className:"mb-0",children:"Investments"})]}),f&&(0,a.jsx)("div",{children:"Loading recommendations..."}),y&&(0,a.jsx)("div",{className:"alert alert-danger",children:y}),g&&(0,a.jsx)("div",{className:"card",children:(0,a.jsxs)("div",{className:"card-body",children:[(0,a.jsxs)("h5",{children:["Risk Profile: ",g.risk_profile]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"Asset Allocation:"}),(0,a.jsx)("ul",{children:Object.entries(g.asset_allocation).map(e=>{let[s,t]=e;return(0,a.jsxs)("li",{children:[s.charAt(0).toUpperCase()+s.slice(1),": ",t,"%"]},s)})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"Expected Return:"})," ",g.expected_return,"%"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"Investment Advice:"}),(0,a.jsx)("ul",{children:g.investment_advice.map((e,s)=>(0,a.jsx)("li",{children:e},s))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"Generated At:"})," ",new Date(g.generated_at).toLocaleString()]})]})}),S&&(0,a.jsx)("div",{className:"modal fade show",style:{display:"block",background:"rgba(0,0,0,0.5)"},tabIndex:-1,role:"dialog",children:(0,a.jsx)("div",{className:"modal-dialog modal-lg",role:"document",children:(0,a.jsxs)("form",{className:"modal-content",onSubmit:en,children:[(0,a.jsxs)("div",{className:"modal-header",children:[(0,a.jsx)("h5",{className:"modal-title",children:"Execute Investment"}),(0,a.jsx)("button",{type:"button",className:"btn-close","aria-label":"Close",onClick:()=>{C(!1),L(""),D("")},disabled:T})]}),(0,a.jsxs)("div",{className:"modal-body",children:[P&&(0,a.jsx)("div",{className:"alert alert-danger",children:P}),O&&(0,a.jsx)("div",{className:"alert alert-success",children:O}),(0,a.jsxs)("div",{className:"mb-3",children:[(0,a.jsx)("label",{className:"form-label",children:"Portfolio"}),(0,a.jsxs)("select",{className:"form-select",name:"portfolio_id",value:B.portfolio_id,onChange:et,required:!0,children:[(0,a.jsx)("option",{value:"",children:"Select Portfolio"}),w.map(e=>(0,a.jsx)("option",{value:e.id,children:e.portfolio_name},e.id))]})]}),(0,a.jsxs)("div",{className:"mb-3",children:[(0,a.jsx)("label",{className:"form-label",children:"Portfolio Name"}),(0,a.jsx)("input",{type:"text",className:"form-control",name:"portfolio_name",value:B.portfolio_name,onChange:et,required:!0})]}),(0,a.jsxs)("div",{className:"mb-3",children:[(0,a.jsx)("label",{className:"form-label",children:"Description"}),(0,a.jsx)("textarea",{className:"form-control",name:"description",value:B.description,onChange:et})]}),(0,a.jsxs)("div",{className:"mb-3",children:[(0,a.jsx)("label",{className:"form-label",children:"Portfolio Type"}),(0,a.jsxs)("select",{className:"form-select",name:"portfolio_type",value:B.portfolio_type,onChange:et,children:[(0,a.jsx)("option",{value:"custom",children:"Custom"}),(0,a.jsx)("option",{value:"model",children:"Model"})]})]}),(0,a.jsxs)("div",{className:"mb-3",children:[(0,a.jsx)("label",{className:"form-label",children:"Risk Profile"}),(0,a.jsxs)("select",{className:"form-select",name:"risk_profile",value:B.risk_profile,onChange:et,children:[(0,a.jsx)("option",{value:"conservative",children:"Conservative"}),(0,a.jsx)("option",{value:"moderate",children:"Moderate"}),(0,a.jsx)("option",{value:"growth",children:"Growth"})]})]}),(0,a.jsxs)("div",{className:"mb-3",children:[(0,a.jsx)("label",{className:"form-label",children:"Instruments"}),B.instruments.map((e,s)=>(0,a.jsxs)("div",{className:"row mb-2",children:[(0,a.jsx)("div",{className:"col",children:(0,a.jsx)("input",{type:"text",className:"form-control",placeholder:"Instrument ID",value:e.instrument_id,onChange:e=>ea(s,"instrument_id",e.target.value),required:!0})}),(0,a.jsx)("div",{className:"col",children:(0,a.jsx)("input",{type:"text",className:"form-control",placeholder:"Instrument Name",value:e.instrument_name,onChange:e=>ea(s,"instrument_name",e.target.value),required:!0})}),(0,a.jsx)("div",{className:"col",children:(0,a.jsx)("input",{type:"text",className:"form-control",placeholder:"Asset Class",value:e.asset_class,onChange:e=>ea(s,"asset_class",e.target.value),required:!0})}),(0,a.jsx)("div",{className:"col",children:(0,a.jsx)("input",{type:"number",className:"form-control",placeholder:"Amount",value:e.amount,min:0,onChange:e=>ea(s,"amount",Number(e.target.value)),required:!0})}),(0,a.jsx)("div",{className:"col-auto",children:B.instruments.length>1&&(0,a.jsx)("button",{type:"button",className:"btn btn-danger",onClick:()=>el(s),disabled:T,children:"\xd7"})})]},s)),(0,a.jsx)("button",{type:"button",className:"btn btn-link",onClick:()=>{R(e=>({...e,instruments:[...e.instruments,{instrument_id:"",instrument_name:"",asset_class:"",amount:0}]}))},disabled:T,children:"+ Add Instrument"})]}),(0,a.jsxs)("div",{className:"mb-3",children:[(0,a.jsx)("label",{className:"form-label",children:"Total Amount"}),(0,a.jsx)("input",{type:"number",className:"form-control",name:"total_amount",value:B.total_amount,readOnly:!0})]}),(0,a.jsxs)("div",{className:"mb-3",children:[(0,a.jsx)("label",{className:"form-label",children:"Source Account"}),(0,a.jsxs)("select",{className:"form-select",name:"source_account_id",value:B.source_account_id,onChange:et,required:!0,children:[(0,a.jsx)("option",{value:"",children:"Select Account"}),A.map(e=>(0,a.jsx)("option",{value:e.id,children:e.account_name},e.id))]})]}),(0,a.jsx)("div",{className:"mb-3",children:(0,a.jsx)("button",{className:"btn btn-primary",type:"submit",disabled:T,children:T?"Executing...":"Execute Investment"})})]})]})})}),q&&(0,a.jsx)("div",{className:"modal fade show",style:{display:"block",background:"rgba(0,0,0,0.5)"},tabIndex:-1,role:"dialog",children:(0,a.jsx)("div",{className:"modal-dialog modal-lg",role:"document",children:(0,a.jsxs)("div",{className:"modal-content",children:[(0,a.jsxs)("div",{className:"modal-header",children:[(0,a.jsx)("h5",{className:"modal-title",children:"Investment Performance"}),(0,a.jsx)("button",{type:"button",className:"btn-close","aria-label":"Close",onClick:()=>z(!1),disabled:G})]}),(0,a.jsxs)("div",{className:"modal-body",children:[G&&(0,a.jsx)("div",{children:"Loading..."}),U&&(0,a.jsx)("div",{className:"alert alert-danger",children:U}),W&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"mb-3",children:[(0,a.jsx)("h5",{children:"Summary"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"Total Investment Value:"})," ₹",null==(e=W.total_investment_value)?void 0:e.toLocaleString()]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"Total Invested Value:"})," ₹",null==(s=W.total_invested_value)?void 0:s.toLocaleString()]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"Total Gain/Loss:"}),(0,a.jsxs)("span",{style:{color:W.total_gain_loss>=0?"green":"red"},children:["₹",null==(t=W.total_gain_loss)?void 0:t.toLocaleString()," (",null==(o=W.total_gain_loss_percentage)?void 0:o.toFixed(2),"%)"]})]})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("h6",{children:"Portfolio Breakdown"}),(0,a.jsxs)("table",{className:"table table-bordered table-sm",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{children:"Name"}),(0,a.jsx)("th",{children:"Current Value (₹)"}),(0,a.jsx)("th",{children:"Gain/Loss (₹)"}),(0,a.jsx)("th",{children:"Gain/Loss (%)"}),(0,a.jsx)("th",{children:"Holdings"}),(0,a.jsx)("th",{children:"Risk Profile"})]})}),(0,a.jsx)("tbody",{children:null==(i=W.portfolios)?void 0:i.map(e=>{var s,t,l;return(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{children:e.name}),(0,a.jsx)("td",{children:null==(s=e.current_value)?void 0:s.toLocaleString()}),(0,a.jsx)("td",{style:{color:e.gain_loss>=0?"green":"red"},children:null==(t=e.gain_loss)?void 0:t.toLocaleString()}),(0,a.jsxs)("td",{style:{color:e.gain_loss_percentage>=0?"green":"red"},children:[null==(l=e.gain_loss_percentage)?void 0:l.toFixed(2),"%"]}),(0,a.jsx)("td",{children:e.holdings_count}),(0,a.jsx)("td",{children:e.risk_profile})]},e.id)})})]})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("h6",{children:"Investment Trends"}),(0,a.jsx)(r.N1,{data:{labels:null==(d=W.trends)||null==(c=d.data_points)?void 0:c.map(e=>e.date),datasets:[{label:"Investments (₹)",data:null==(u=W.trends)||null==(m=u.data_points)?void 0:m.map(e=>e.investments),borderColor:"#36A2EB",backgroundColor:"rgba(54,162,235,0.1)",tension:.3},{label:"Withdrawals (₹)",data:null==(x=W.trends)||null==(h=x.data_points)?void 0:h.map(e=>e.withdrawals),borderColor:"#FF6384",backgroundColor:"rgba(255,99,132,0.1)",tension:.3},{label:"Net Flow (₹)",data:null==(j=W.trends)||null==(v=j.data_points)?void 0:v.map(e=>e.net_flow),borderColor:"#4BC0C0",backgroundColor:"rgba(75,192,192,0.1)",tension:.3},{label:"Cumulative Investment (₹)",data:null==(b=W.trends)||null==(p=b.data_points)?void 0:p.map(e=>e.cumulative_investment),borderColor:"#FFCE56",backgroundColor:"rgba(255,206,86,0.1)",tension:.3}]},options:{responsive:!0,plugins:{legend:{display:!0},tooltip:{enabled:!0}},scales:{y:{beginAtZero:!0}}},height:180})]})]})]})]})})}),H&&(0,a.jsx)("div",{className:"modal fade show",style:{display:"block",background:"rgba(0,0,0,0.5)"},tabIndex:-1,role:"dialog",children:(0,a.jsx)("div",{className:"modal-dialog",role:"document",children:(0,a.jsxs)("form",{className:"modal-content",onSubmit:e=>e.preventDefault(),children:[(0,a.jsxs)("div",{className:"modal-header",children:[(0,a.jsx)("h5",{className:"modal-title",children:"Investment Recommendation"}),(0,a.jsx)("button",{type:"button",className:"btn-close","aria-label":"Close",onClick:ei})]}),(0,a.jsxs)("div",{className:"modal-body",children:[$&&(0,a.jsx)("div",{children:"Loading..."}),Q&&(0,a.jsx)("div",{className:"alert alert-danger",children:Q}),Y&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"mb-3",children:[(0,a.jsx)("label",{className:"form-label",children:"Risk Profile"}),(0,a.jsx)("input",{className:"form-control",name:"risk_profile",value:Y.risk_profile,onChange:ec,readOnly:!0})]}),(0,a.jsxs)("div",{className:"mb-3",children:[(0,a.jsx)("label",{className:"form-label",children:"Asset Allocation"}),Object.entries(Y.asset_allocation).map(e=>{let[s,t]=e;return(0,a.jsxs)("div",{className:"input-group mb-1",children:[(0,a.jsx)("span",{className:"input-group-text",style:{minWidth:80},children:s.charAt(0).toUpperCase()+s.slice(1)}),(0,a.jsx)("input",{type:"number",className:"form-control",name:"asset_allocation.".concat(s),value:t,onChange:ec}),(0,a.jsx)("span",{className:"input-group-text",children:"%"})]},s)})]}),(0,a.jsxs)("div",{className:"mb-3",children:[(0,a.jsx)("label",{className:"form-label",children:"Expected Return (%)"}),(0,a.jsx)("input",{className:"form-control",name:"expected_return",value:Y.expected_return,onChange:ec,type:"number"})]}),(0,a.jsxs)("div",{className:"mb-3",children:[(0,a.jsx)("label",{className:"form-label",children:"Timeframe"}),(0,a.jsx)("input",{className:"form-control",name:"timeframe",value:Y.timeframe,onChange:ec})]}),(0,a.jsxs)("div",{className:"mb-3",children:[(0,a.jsx)("label",{className:"form-label",children:"Investment Advice"}),(0,a.jsx)("ul",{children:Y.investment_advice.map((e,s)=>(0,a.jsx)("li",{children:e},s))})]}),(0,a.jsxs)("div",{className:"mb-3",children:[(0,a.jsx)("label",{className:"form-label",children:"Generated At"}),(0,a.jsx)("input",{className:"form-control",value:new Date(Y.generated_at).toLocaleString(),readOnly:!0})]})]})]}),(0,a.jsx)("div",{className:"modal-footer",children:(0,a.jsx)("button",{type:"button",className:"btn btn-secondary",onClick:ei,children:"Close"})})]})})}),S&&(0,a.jsx)("div",{className:"modal-backdrop fade show",style:{display:"block"}}),q&&(0,a.jsx)("div",{className:"modal-backdrop fade show",style:{display:"block"}}),H&&(0,a.jsx)("div",{className:"modal-backdrop fade show",style:{display:"block"}})]})}o.t1.register(o.E8,o.PP,o.kc,o.m_,o.s$,o.No,o.FN,o.UA)},7523:(e,s,t)=>{"use strict";t.d(s,{J1:()=>o,h_:()=>a,iD:()=>l,zu:()=>r});let a=(e,s,t,a)=>{if(localStorage.setItem("accessToken",e),localStorage.setItem("refreshToken",s),localStorage.setItem("userId",t),a)a.email&&localStorage.setItem("userEmail",a.email),a.full_name&&localStorage.setItem("userFullName",a.full_name),a.expires_in&&localStorage.setItem("expiresIn",a.expires_in.toString()),a.token_type&&localStorage.setItem("tokenType",a.token_type);else{let s=function(e){try{return JSON.parse(atob(e.split(".")[1]))}catch(e){return null}}(e);s&&s.sub&&localStorage.setItem("userId",s.sub)}},l=()=>localStorage.getItem("accessToken"),n=()=>localStorage.getItem("refreshToken"),r=()=>{localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken")},o=async()=>{let e=n();if(!e)return null;try{let s=await fetch("".concat("https://travis-2d4m.onrender.com/api/v1","/api/v1/auth/refresh"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refresh_token:e})});if(!s.ok)return r(),null;{let t=await s.json();return a(t.access_token,t.refresh_token||e,JSON.stringify({user_id:t.user_id,email:t.email,full_name:t.full_name,expires_in:t.expires_in,token_type:t.token_type})),t.access_token}}catch(e){return console.error("Error refreshing token:",e),r(),null}}}},e=>{var s=s=>e(e.s=s);e.O(0,[598,602,192,674,358],()=>s(1429)),_N_E=e.O()}]);